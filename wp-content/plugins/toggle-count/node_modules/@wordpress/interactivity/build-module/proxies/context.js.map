{"version":3,"names":["contextObjectToProxy","WeakMap","contextObjectToFallback","contextProxies","WeakSet","descriptor","Reflect","getOwnPropertyDescriptor","contextHandlers","get","target","key","fallback","currentProp","set","value","obj","ownKeys","Set","Object","keys","has","proxifyContext","current","inherited","Error","proxy","Proxy","add"],"sources":["@wordpress/interactivity/src/proxies/context.ts"],"sourcesContent":["const contextObjectToProxy = new WeakMap();\nconst contextObjectToFallback = new WeakMap();\nconst contextProxies = new WeakSet();\n\nconst descriptor = Reflect.getOwnPropertyDescriptor;\n\n// TODO: Use the proxy registry to avoid multiple proxies on the same object.\nconst contextHandlers: ProxyHandler< object > = {\n\tget: ( target, key ) => {\n\t\tconst fallback = contextObjectToFallback.get( target );\n\t\t// Always subscribe to prop changes in the current context.\n\t\tconst currentProp = target[ key ];\n\n\t\t/*\n\t\t * Return the value from `target` if it exists, or from `fallback`\n\t\t * otherwise. This way, in the case the property doesn't exist either in\n\t\t * `target` or `fallback`, it also subscribes to changes in the parent\n\t\t * context.\n\t\t */\n\t\treturn key in target ? currentProp : fallback[ key ];\n\t},\n\tset: ( target, key, value ) => {\n\t\tconst fallback = contextObjectToFallback.get( target );\n\n\t\t// If the property exists in the current context, modify it. Otherwise,\n\t\t// add it to the current context.\n\t\tconst obj = key in target || ! ( key in fallback ) ? target : fallback;\n\t\tobj[ key ] = value;\n\n\t\treturn true;\n\t},\n\townKeys: ( target ) => [\n\t\t...new Set( [\n\t\t\t...Object.keys( contextObjectToFallback.get( target ) ),\n\t\t\t...Object.keys( target ),\n\t\t] ),\n\t],\n\tgetOwnPropertyDescriptor: ( target, key ) =>\n\t\tdescriptor( target, key ) ||\n\t\tdescriptor( contextObjectToFallback.get( target ), key ),\n\thas: ( target, key ) =>\n\t\tReflect.has( target, key ) ||\n\t\tReflect.has( contextObjectToFallback.get( target ), key ),\n};\n\n/**\n * Wrap a context object with a proxy to reproduce the context stack. The proxy\n * uses the passed `inherited` context as a fallback to look up for properties\n * that don't exist in the given context. Also, updated properties are modified\n * where they are defined, or added to the main context when they don't exist.\n *\n * @param current   Current context.\n * @param inherited Inherited context, used as fallback.\n *\n * @return The wrapped context object.\n */\nexport const proxifyContext = (\n\tcurrent: object,\n\tinherited: object = {}\n): object => {\n\tif ( contextProxies.has( current ) ) {\n\t\tthrow Error( 'This object cannot be proxified.' );\n\t}\n\t// Update the fallback object reference when it changes.\n\tcontextObjectToFallback.set( current, inherited );\n\tif ( ! contextObjectToProxy.has( current ) ) {\n\t\tconst proxy = new Proxy( current, contextHandlers );\n\t\tcontextObjectToProxy.set( current, proxy );\n\t\tcontextProxies.add( proxy );\n\t}\n\treturn contextObjectToProxy.get( current );\n};\n"],"mappings":"AAAA,MAAMA,oBAAoB,GAAG,IAAIC,OAAO,CAAC,CAAC;AAC1C,MAAMC,uBAAuB,GAAG,IAAID,OAAO,CAAC,CAAC;AAC7C,MAAME,cAAc,GAAG,IAAIC,OAAO,CAAC,CAAC;AAEpC,MAAMC,UAAU,GAAGC,OAAO,CAACC,wBAAwB;;AAEnD;AACA,MAAMC,eAAuC,GAAG;EAC/CC,GAAG,EAAEA,CAAEC,MAAM,EAAEC,GAAG,KAAM;IACvB,MAAMC,QAAQ,GAAGV,uBAAuB,CAACO,GAAG,CAAEC,MAAO,CAAC;IACtD;IACA,MAAMG,WAAW,GAAGH,MAAM,CAAEC,GAAG,CAAE;;IAEjC;AACF;AACA;AACA;AACA;AACA;IACE,OAAOA,GAAG,IAAID,MAAM,GAAGG,WAAW,GAAGD,QAAQ,CAAED,GAAG,CAAE;EACrD,CAAC;EACDG,GAAG,EAAEA,CAAEJ,MAAM,EAAEC,GAAG,EAAEI,KAAK,KAAM;IAC9B,MAAMH,QAAQ,GAAGV,uBAAuB,CAACO,GAAG,CAAEC,MAAO,CAAC;;IAEtD;IACA;IACA,MAAMM,GAAG,GAAGL,GAAG,IAAID,MAAM,IAAI,EAAIC,GAAG,IAAIC,QAAQ,CAAE,GAAGF,MAAM,GAAGE,QAAQ;IACtEI,GAAG,CAAEL,GAAG,CAAE,GAAGI,KAAK;IAElB,OAAO,IAAI;EACZ,CAAC;EACDE,OAAO,EAAIP,MAAM,IAAM,CACtB,GAAG,IAAIQ,GAAG,CAAE,CACX,GAAGC,MAAM,CAACC,IAAI,CAAElB,uBAAuB,CAACO,GAAG,CAAEC,MAAO,CAAE,CAAC,EACvD,GAAGS,MAAM,CAACC,IAAI,CAAEV,MAAO,CAAC,CACvB,CAAC,CACH;EACDH,wBAAwB,EAAEA,CAAEG,MAAM,EAAEC,GAAG,KACtCN,UAAU,CAAEK,MAAM,EAAEC,GAAI,CAAC,IACzBN,UAAU,CAAEH,uBAAuB,CAACO,GAAG,CAAEC,MAAO,CAAC,EAAEC,GAAI,CAAC;EACzDU,GAAG,EAAEA,CAAEX,MAAM,EAAEC,GAAG,KACjBL,OAAO,CAACe,GAAG,CAAEX,MAAM,EAAEC,GAAI,CAAC,IAC1BL,OAAO,CAACe,GAAG,CAAEnB,uBAAuB,CAACO,GAAG,CAAEC,MAAO,CAAC,EAAEC,GAAI;AAC1D,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,MAAMW,cAAc,GAAGA,CAC7BC,OAAe,EACfC,SAAiB,GAAG,CAAC,CAAC,KACV;EACZ,IAAKrB,cAAc,CAACkB,GAAG,CAAEE,OAAQ,CAAC,EAAG;IACpC,MAAME,KAAK,CAAE,kCAAmC,CAAC;EAClD;EACA;EACAvB,uBAAuB,CAACY,GAAG,CAAES,OAAO,EAAEC,SAAU,CAAC;EACjD,IAAK,CAAExB,oBAAoB,CAACqB,GAAG,CAAEE,OAAQ,CAAC,EAAG;IAC5C,MAAMG,KAAK,GAAG,IAAIC,KAAK,CAAEJ,OAAO,EAAEf,eAAgB,CAAC;IACnDR,oBAAoB,CAACc,GAAG,CAAES,OAAO,EAAEG,KAAM,CAAC;IAC1CvB,cAAc,CAACyB,GAAG,CAAEF,KAAM,CAAC;EAC5B;EACA,OAAO1B,oBAAoB,CAACS,GAAG,CAAEc,OAAQ,CAAC;AAC3C,CAAC","ignoreList":[]}